<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #selectBtn {
            background-color: #2196F3;
            color: white;
        }
        #selectBtn:hover {
            background-color: #0b7dda;
        }
        #recordBtn {
            background-color: #4CAF50;
            color: white;
        }
        #recordBtn.recording {
            background-color: #f44336;
        }
        #recordBtn:hover:not(.recording) {
            background-color: #45a049;
        }
        #recordBtn:hover.recording {
            background-color: #da190b;
        }
        .status {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .recording {
            background-color: #ffebee;
            color: #c62828;
        }
        .info {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        .selection-info {
            background-color: #f1f8e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            border-left: 4px solid #4CAF50;
        }
        
        .recording-area-hint {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            border: 1px solid #4CAF50;
        }
        
        .recording-area-hint p {
            margin: 5px 0;
        }
        .instructions {
            background-color: #fff8e1;
            color: #ff8f00;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FFmpeg å±å¹•å½•åˆ¶å·¥å…·</h1>
        
        <div class="controls">
            <button id="selectBtn">é€‰æ‹©å½•åˆ¶åŒºåŸŸ</button>
            <button id="recordBtn">å¼€å§‹å½•åˆ¶ (F2)</button>
        </div>
        
        <div id="status" class="status info">
            è¯·å…ˆé€‰æ‹©è¦å½•åˆ¶çš„å±å¹•åŒºåŸŸ
        </div>
        
        <div id="selectionInfo" class="selection-info hidden">
            <h3>å·²é€‰æ‹©å½•åˆ¶åŒºåŸŸ:</h3>
            <p>ä½ç½®: <span id="position">-</span></p>
            <p>å°ºå¯¸: <span id="size">-</span></p>
            <div class="recording-area-hint">
                <p><strong>å½•åˆ¶åŒºåŸŸå·²ç¡®å®š</strong></p>
                <p>è¯·ç¡®ä¿æ‚¨è¦å½•åˆ¶çš„å†…å®¹åœ¨é€‰å®šåŒºåŸŸå†…</p>
            </div>
        </div>
        
        <div class="instructions">
            <h3>ä½¿ç”¨è¯´æ˜:</h3>
            <ul>
                <li><strong>ç¬¬ä¸€æ¬¡æŒ‰ F2</strong>ï¼šé€‰æ‹©å½•åˆ¶åŒºåŸŸï¼ˆåœ¨å±å¹•ä¸Šæ‹–æ‹½é€‰æ‹©ï¼‰</li>
                <li><strong>ç¬¬äºŒæ¬¡æŒ‰ F2</strong>ï¼šå¼€å§‹å½•åˆ¶</li>
                <li><strong>ç¬¬ä¸‰æ¬¡æŒ‰ F2</strong>ï¼šåœæ­¢å½•åˆ¶å¹¶ä¿å­˜æ–‡ä»¶</li>
                <li>å½•åˆ¶æœŸé—´æ‚¨å¯ä»¥æ“ä½œé€‰åŒºå¤–çš„åŒºåŸŸ</li>
                <li>ä½¿ç”¨ FFmpeg è¿›è¡Œå½•åˆ¶ï¼Œæ›´åŠ ç¨³å®šé«˜æ•ˆ</li>
            </ul>
        </div>
    </div>

    <script>
        const { ipcRenderer, shell } = require('electron');
        
        const selectBtn = document.getElementById('selectBtn');
        const recordBtn = document.getElementById('recordBtn');
        const statusEl = document.getElementById('status');
        const selectionInfo = document.getElementById('selectionInfo');
        const positionEl = document.getElementById('position');
        const sizeEl = document.getElementById('size');
        
        let selectedBounds = null;
        let isRecording = false;
        
        selectBtn.addEventListener('click', () => {
            ipcRenderer.send('start-overlay');
            statusEl.textContent = 'è¯·åœ¨å±å¹•ä¸Šæ‹–æ‹½é€‰æ‹©å½•åˆ¶åŒºåŸŸ';
            statusEl.className = 'status info';
        });
        
        recordBtn.addEventListener('click', () => {
            if (isRecording) {
                ipcRenderer.send('stop-recording');
            } else {
                if (selectedBounds) {
                    ipcRenderer.send('start-recording');
                } else {
                    statusEl.textContent = 'è¯·å…ˆé€‰æ‹©å½•åˆ¶åŒºåŸŸ';
                    statusEl.className = 'status info';
                }
            }
        });
        
        // æ¥æ”¶F2æŒ‰é”®äº‹ä»¶
        ipcRenderer.on('f2-pressed', () => {
            // å¦‚æœæ­£åœ¨å½•åˆ¶ï¼ŒæŒ‰F2åœæ­¢å½•åˆ¶
            if (isRecording) {
                ipcRenderer.send('stop-recording');
            }
            // å¦‚æœæ²¡æœ‰é€‰åŒºï¼ŒæŒ‰F2è¿›è¡ŒåŒºåŸŸé€‰æ‹©
            else if (!selectedBounds) {
                ipcRenderer.send('start-overlay');
                statusEl.textContent = 'è¯·åœ¨å±å¹•ä¸Šæ‹–æ‹½é€‰æ‹©å½•åˆ¶åŒºåŸŸ';
                statusEl.className = 'status info';
            }
            // å¦‚æœæœ‰é€‰åŒºä¸”æœªåœ¨å½•åˆ¶ï¼ŒæŒ‰F2å¼€å§‹å½•åˆ¶
            else if (selectedBounds && !isRecording) {
                ipcRenderer.send('start-recording');
            }
        });
        
        // æ¥æ”¶é€‰åŒºå®Œæˆäº‹ä»¶
        ipcRenderer.on('selection-made', (event, bounds) => {
            selectedBounds = bounds;
            positionEl.textContent = `${bounds.x}, ${bounds.y}`;
            sizeEl.textContent = `${bounds.width} Ã— ${bounds.height}`;
            selectionInfo.classList.remove('hidden');
            statusEl.innerHTML = 'å·²é€‰æ‹©å½•åˆ¶åŒºåŸŸ<br><strong style="color: #4CAF50; font-size: 18px;">æŒ‰ F2 é”®å¼€å§‹å½•åˆ¶</strong>';
            statusEl.className = 'status info';
        });
        
        // æ¥æ”¶é€‰åŒºå–æ¶ˆäº‹ä»¶
        ipcRenderer.on('selection-canceled', () => {
            selectedBounds = null;
            selectionInfo.classList.add('hidden');
            statusEl.textContent = 'å·²å–æ¶ˆé€‰æ‹©å½•åˆ¶åŒºåŸŸ';
            statusEl.className = 'status info';
        });
        
        // æ¥æ”¶å½•åˆ¶å¼€å§‹äº‹ä»¶
        ipcRenderer.on('recording-started', () => {
            isRecording = true;
            recordBtn.textContent = 'åœæ­¢å½•åˆ¶ (F2)';
            recordBtn.classList.add('recording');
            statusEl.innerHTML = '<strong style="font-size: 18px;">ğŸ”´ æ­£åœ¨å½•åˆ¶ä¸­...</strong><br>æŒ‰ F2 é”®åœæ­¢å½•åˆ¶';
            statusEl.className = 'status recording';
        });
        
        // æ¥æ”¶å½•åˆ¶ä¿å­˜äº‹ä»¶
        ipcRenderer.on('recording-saved', (event, filePath) => {
            isRecording = false;
            recordBtn.textContent = 'å¼€å§‹å½•åˆ¶ (F2)';
            recordBtn.classList.remove('recording');
            // æ¸…ç©ºé€‰åŒºä¿¡æ¯ï¼Œä¸‹æ¬¡F2é‡æ–°å¼€å§‹é€‰æ‹©
            selectedBounds = null;
            selectionInfo.classList.add('hidden');
            statusEl.textContent = `å½•åˆ¶å·²å®Œæˆï¼Œæ–‡ä»¶å·²ä¿å­˜åˆ°: ${filePath}ã€‚æŒ‰ F2 é”®é‡æ–°é€‰æ‹©å½•åˆ¶åŒºåŸŸ`;
            statusEl.className = 'status info';
        });
        
        // æ¥æ”¶å½•åˆ¶å–æ¶ˆäº‹ä»¶
        ipcRenderer.on('recording-canceled', () => {
            isRecording = false;
            recordBtn.textContent = 'å¼€å§‹å½•åˆ¶ (F2)';
            recordBtn.classList.remove('recording');
            // æ¸…ç©ºé€‰åŒºä¿¡æ¯ï¼Œä¸‹æ¬¡F2é‡æ–°å¼€å§‹é€‰æ‹©
            selectedBounds = null;
            selectionInfo.classList.add('hidden');
            statusEl.textContent = 'å½•åˆ¶å·²å–æ¶ˆã€‚æŒ‰ F2 é”®é‡æ–°é€‰æ‹©å½•åˆ¶åŒºåŸŸ';
            statusEl.className = 'status info';
        });
        
        // æ¥æ”¶å½•åˆ¶é”™è¯¯äº‹ä»¶
        ipcRenderer.on('recording-error', (event, error) => {
            isRecording = false;
            recordBtn.textContent = 'å¼€å§‹å½•åˆ¶ (F2)';
            recordBtn.classList.remove('recording');
            // æ¸…ç©ºé€‰åŒºä¿¡æ¯ï¼Œä¸‹æ¬¡F2é‡æ–°å¼€å§‹é€‰æ‹©
            selectedBounds = null;
            selectionInfo.classList.add('hidden');
            statusEl.textContent = `å½•åˆ¶å‡ºé”™: ${error}ã€‚æŒ‰ F2 é”®é‡æ–°é€‰æ‹©å½•åˆ¶åŒºåŸŸ`;
            statusEl.className = 'status recording';
        });
        
        // æ¥æ”¶å½•åˆ¶åœæ­¢äº‹ä»¶
        ipcRenderer.on('recording-stopped', () => {
            isRecording = false;
            recordBtn.textContent = 'å¼€å§‹å½•åˆ¶ (F2)';
            recordBtn.classList.remove('recording');
            // ä¿æŒé€‰åŒºä¿¡æ¯ï¼Œä¸æ¸…ç©ºselectedBounds
            statusEl.textContent = 'å½•åˆ¶å·²åœæ­¢ã€‚æŒ‰ F2 é”®é‡æ–°é€‰æ‹©åŒºåŸŸæˆ–å¼€å§‹æ–°å½•åˆ¶';
            statusEl.className = 'status info';
        });
        

    </script>
</body>
</html>